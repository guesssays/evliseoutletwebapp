/* === styles.css (очищенная финальная версия) === */

/* ====== Глобальные переменные / базовая типографика ====== */
:root{
  --c-01:#292526; --c-02:#787676; --c-03:#A3A1A2; --c-04:#F2F2F2; --c-05:#121111;
  --bg:#ffffff; --text:#121111; --muted:#787676; --paper:#ffffff; --stroke:#ececec;
  --radius:22px; --r-sm:14px; --shadow:0 8px 24px rgba(0,0,0,.08);
  --tabbar-h:92px;
  --safe: env(safe-area-inset-bottom, 0px);
  --safe-top: env(safe-area-inset-top, 0px);
  --toastTop:16px;

  /* Z-слои (единый источник правды) */
  --z-tabbar: 30;
  --z-app-header: 40;
  --z-fixhdr: 80;
  --z-scrolltop: 120;
  --z-toast: 140;
  --z-modal: 100;
  --scrolltop-gap: 26px; /* удобный зазор над таббаром */
}

*{ box-sizing:border-box; }
html,body{ height:100%; max-width:100vw; overflow-x:hidden; }
body{
  margin:0; background:var(--bg); color:var(--text);
  font:16px/1.5 "Encode Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  padding-bottom:calc(var(--tabbar-h) + var(--safe) + 24px);
}

img,video{ max-width:100%; height:auto; display:block; }

.lucide,[data-lucide]{ stroke:currentColor; fill:none }

/* ====== Статичный хедер ====== */
.app-header{
  position:sticky;
  top: calc(env(safe-area-inset-top, 0px));
  z-index: var(--z-app-header);
  backdrop-filter:saturate(1.2) blur(6px);
  background:linear-gradient(180deg, rgba(255,255,255,.92) 0%, rgba(255,255,255,.82) 100%);
  padding:14px 18px 10px;
  display:flex; justify-content:space-between; align-items:center; gap:10px;
  border-bottom:1px solid var(--stroke);
  transition: opacity .18s ease, transform .18s ease, visibility .18s ease;
}
.app-header.hidden{ opacity:0; transform:translateY(-8px); pointer-events:none; visibility:hidden; }

.hdr-left,.hdr-right{ display:flex; align-items:center; gap:10px; }
.brand{ display:flex; align-items:center; gap:10px; }
.app-title{ font-weight:800; font-size:22px; letter-spacing:.8px; text-transform:uppercase; }

/* Квадратные иконки */
.icon-btn,.square-btn{
  display:inline-grid; place-items:center;
  width:44px; height:44px; border-radius:14px;
  border:1px solid var(--stroke); background:#f6f6f6; color:var(--text);
  cursor:pointer;
}
.icon-btn i,.square-btn i{ width:22px;height:22px }
.notif-btn{ position:relative; }
#notifBadge.badge{
  position:absolute; right:-6px; top:-6px;
  background:#ff5966; color:#fff; font-size:11px; line-height:1;
  border-radius:999px; padding:3px 6px; box-shadow:0 2px 10px rgba(0,0,0,.18);
}

/* ====== Фикс-хедер товара (прозрачный слой + 2 кнопки) ====== */
#productFixHdr,
.product-fixhdr{
  position:fixed; left:0; right:0; top:0;
  z-index: var(--z-fixhdr);
  transform: translateY(-110%);
  transition: transform .18s ease, opacity .18s ease;
  opacity: 0;
  background: transparent !important;
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  pointer-events: auto; /* контейнер не блокирует клики по кнопкам */
}
#productFixHdr.show,
.product-fixhdr.show{
  transform: translateY(0);
  opacity: 1;
}
.product-fixhdr .fixbtn,
#productFixHdr .fixbtn,
.hero-btn{
  width:48px; height:48px;
  border-radius:999px;
  display:grid; place-items:center;
  background:#fff;
  border:1px solid var(--stroke);
  box-shadow:var(--shadow);
  color:var(--text);
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  user-select:none; -webkit-user-select:none;
}
.product-fixhdr .fixbtn i, .product-fixhdr .fixbtn svg,
#productFixHdr .fixbtn i, #productFixHdr .fixbtn svg,
.hero-btn i, .hero-btn svg{ width:22px; height:22px; stroke:currentColor; fill:none; }

#btnFixBack{ position:absolute; left:12px; top:calc(6px + var(--safe-top)); }
#btnFixFav{  position:absolute; right:12px; top:calc(6px + var(--safe-top)); }
#btnFixFav.active .lucide-heart,
.hero-fav.active .lucide-heart{ color:#ff4d5a; fill:currentColor; stroke:none }

/* ====== Поиск/чипы ====== */
.section{ padding:0 18px; margin:10px 0 }
.section-search{ display:flex; gap:10px; align-items:center }
.search-wrap{ position:relative; flex:1 }
.search-ico{ position:absolute; left:12px; top:50%; transform:translateY(-50%); width:20px; height:20px; color:#a0a0a0 }
.search{
  width:100%; height:48px; border-radius:16px; padding:0 14px 0 38px;
  border:1px solid var(--stroke); background:#fff; font:600 16px "Encode Sans";
}
.chipbar{ display:flex; gap:10px; overflow:auto; padding-bottom:6px }
.chip{
  display:inline-flex; align-items:center; gap:8px;
  padding:10px 14px; border:1px solid var(--stroke); border-radius:16px; background:#fff;
  font-weight:700; color:var(--text); white-space:nowrap;
}
.chip.active{ background:#121111; color:#fff; border-color:#121111 }
.chip i{ width:18px; height:18px }
.chip-mini{ padding:8px 12px; font-size:13px }

/* ====== Контент / карточки ====== */
.view{ padding:0 18px 24px; max-width:100vw; overflow-x:hidden; }
.grid{ display:grid; grid-template-columns:1fr 1fr; gap:14px }
.home-bottom-pad{ padding-bottom:calc(var(--tabbar-h) + var(--safe)); }

.card{ position:relative; display:flex; flex-direction:column; text-decoration:none; color:inherit; background:#fff; border-radius:20px; overflow:hidden }
.card-img{ position:relative; aspect-ratio:3/4; border-radius:22px; overflow:hidden }
.card-img img{ width:100%; height:100%; object-fit:cover; display:block }
.card .fav{
  position:absolute; right:10px; top:10px; z-index:5;
  width:42px; height:42px; border-radius:50%; border:none; background:#fff; box-shadow:var(--shadow);
  display:grid; place-items:center; cursor:pointer; -webkit-tap-highlight-color:transparent;
}
.card .fav svg,.card .fav i{ pointer-events:none; }
.card .fav.active .lucide-heart{ color:#ff4d5a; fill:currentColor; stroke:none; transition:transform .12s ease; }
.card .fav.active:active .lucide-heart{ transform:scale(0.92); }
.card-body{ padding:10px 6px }
.card-body .title{ font-weight:800; font-size:20px; margin-bottom:2px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.card-body .subtitle{ color:var(--muted) }
.price-row{ display:flex; justify-content:space-between; align-items:center; margin-top:10px }
.price{ font-weight:800; font-size:20px }

/* ====== Продукт ====== */
.product{ display:block }
.gallery{ display:grid; gap:10px; }
.gallery-main{ position:relative; border-radius:24px; overflow:hidden; background:#f6f6f6; }
.gallery-main img{ width:100%; height:auto; display:block; }

.p-hero{
  position:relative; margin:0 18px;
  border-top-left-radius:24px; border-top-right-radius:24px;
  border-bottom-left-radius:0; border-bottom-right-radius:0;
  overflow:visible;
}
.hero-back{ left:12px } .hero-fav{ right:12px }

.thumbs{ display:flex; gap:10px; overflow:auto; -webkit-overflow-scrolling:touch; padding-bottom:2px; border-radius:0; }
.thumb{ flex:0 0 auto; width:72px; height:72px; border-radius:12px; padding:0; border:2px solid transparent; overflow:hidden; background:#fff; cursor:pointer; }
.thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
.thumb.active{ border-color:#121111; }

.real-photos{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.real-photo{ border-radius:16px; overflow:hidden; background:#f6f6f6; }
.real-photo img{ width:100%; height:auto; display:block; }

.p-body{ padding:16px 18px }
.product .p-body.home-bottom-pad{ padding-bottom:calc(var(--tabbar-h) + var(--safe) + 8px); }

.p-title{ font-size:34px; font-weight:800; line-height:1.15; margin:8px 0 6px }
.p-desc{ color:var(--muted) }
.qty-row{ display:flex; gap:10px; align-items:center }
.qty-ctrl{ display:flex; align-items:center; gap:10px }
.ctrl{ width:44px; height:44px; border:1px solid var(--stroke); border-radius:14px; display:grid; place-items:center; background:#fff }

/* ====== Опции товара ====== */
.p-options{ display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:12px }
.opt-title{ font-weight:800; margin:10px 0 }
.sizes{ display:flex; gap:10px; flex-wrap:wrap }
.size{ padding:10px 14px; border:1px solid var(--stroke); border-radius:999px; background:#fff; font-weight:700; cursor:pointer }
.size.active{ background:#121111; color:#fff; border-color:#121111 }
.colors{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }
.sw{ width:34px; height:34px; border-radius:50%; border:2px solid #fff; outline:1px solid #e5e5e5; cursor:pointer }
.sw.active{ outline-color:#121111 }
.specs{ margin-top:10px; color:var(--muted) }

.table-wrap{ overflow:auto; -webkit-overflow-scrolling:touch; margin-top:10px; border:1px solid var(--stroke); border-radius:16px }
.size-table{ width:100%; border-collapse:separate; border-spacing:0 }
.size-table th,.size-table td{ padding:10px 12px; white-space:nowrap; font-size:14px }
.size-table thead th{ background:#f8f8f8; text-align:left; font-weight:800 }
.size-table tbody tr:not(:last-child) td{ border-bottom:1px solid var(--stroke) }

/* ====== Кнопки ====== */
.btn{
  width:100%; height:64px; border:none; border-radius:999px;
  display:flex; align-items:center; justify-content:center; gap:10px; cursor:pointer;
  font-weight:800; font-size:18px; background:#121111; color:#fff;
  transition:transform .08s ease, opacity .15s ease, box-shadow .2s ease; box-shadow:0 8px 24px rgba(0,0,0,.08);
}
.btn i{ width:22px; height:22px }
.btn:active{ transform:translateY(1px) }
.btn:hover{ box-shadow:0 10px 28px rgba(0,0,0,.12) }
.btn:focus-visible{ outline:2px solid #121111; outline-offset:3px; }
.btn:disabled{ opacity:.6; cursor:not-allowed; box-shadow:none; }
.btn.outline{ background:#fff; color:#121111; border:1px solid var(--stroke); box-shadow:none; }
.btn.primary{ background:#121111; color:#fff; border:1px solid #121111; }

/* Пилюли */
.pill{
  display:inline-flex; gap:8px; align-items:center;
  border-radius:999px; border:1px solid var(--stroke);
  padding:10px 14px; font-weight:700; background:#fff;
  text-decoration:none; color:var(--text); white-space:nowrap; cursor:pointer;
}
.pill.small{ padding:8px 12px }
.pill.primary{ background:#121111; color:#fff; border-color:#121111 }
.pill i{ width:18px; height:18px }
.pill:focus-visible{ outline:2px solid #121111; outline-offset:3px; }

/* ====== Формы ====== */
.form-grid{ display:grid; gap:10px; }
.field{ display:grid; gap:6px; }
.field > span{ font-weight:800; font-size:14px; }
.input{
  width:100%; height:44px; border-radius:12px; border:1px solid var(--stroke);
  padding:0 12px; font:600 15px "Encode Sans";
  background:#fff; color:var(--text);
}
.input[type="file"]{ padding:8px 10px; height:auto; }
.field .helper{ color:var(--muted); font-size:12px; }

/* ====== Корзина / чек-аут ====== */
.section-title{ font-size:24px; font-weight:800; margin:10px 18px }
.checkout{ padding:0 18px calc(var(--tabbar-h) + var(--safe) + 24px); display:grid; gap:14px; max-width:100vw; overflow-x:hidden; }

/* Строка товара в корзине — финальная раскладка */
.cart-row{
  display:grid;
  grid-template-columns:72px minmax(0,1fr) max-content;
  gap:14px; align-items:center;
  padding:12px 0; border-bottom:1px solid var(--stroke);
}
.cart-img{ width:72px; height:72px; border-radius:16px; overflow:hidden }
.cart-img img{ width:100%; height:100%; object-fit:cover }
.cart-title{ font-weight:800; font-size:18px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.cart-sub{ color:var(--muted); font-size:14px; margin-top:2px; overflow-wrap:anywhere; }
.cart-price{ font-weight:800; }
.cart-row > div:nth-child(2){ min-width:0; }

.qty-mini{
  display:inline-flex; align-items:center; gap:10px;
  white-space:nowrap; justify-self:end; align-self:center;
}
.qty-mini .ctrl{ width:36px; height:36px; border-radius:12px }

/* Блок списания баллов */
.cashback-box .cart-title{
  display:flex; align-items:center; gap:8px;
  overflow:visible; white-space:normal; text-overflow:unset;
}
.cashback-box .cart-title .muted{ margin-left:auto; }
.cashback-box .row{
  display:grid; grid-template-columns:minmax(0,1fr) auto; gap:8px; align-items:center;
}
.cashback-box .btns{ display:flex; gap:6px; flex-wrap:wrap; }
.cashback-box input.input{ width:100%; min-width:0; }

/* Итого/адрес */
.address-row{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
.address-left{ min-width:0; flex:1; }
.address-left .cart-title{ margin-bottom:2px }
.address-left .cart-sub{ overflow-wrap:anywhere; }
.payline{ display:grid; gap:10px; border-top:1px solid var(--stroke); padding:12px 0 }
.payrow{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
.payrow span, .payrow b{ min-width:0; overflow:hidden; text-overflow:ellipsis; }

/* ====== Уведомления ====== */
.notes{ display:grid; gap:8px; margin:0 18px 18px; }
.note{
  display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center;
  padding:12px; border:1px solid var(--stroke); border-radius:14px; background:#fff;
}
.note i{ width:22px; height:22px; opacity:.9; }
.note-title{ font-weight:800; line-height:1.25; }
.note-sub{ color:var(--muted); font-size:14px; margin-top:2px; }
.note .time{ color:var(--muted); font-size:12px; white-space:nowrap; }
.notes-empty{
  margin:0 18px 18px; padding:14px;
  border:1px dashed var(--stroke); border-radius:14px; background:#fff; 
  color: var(--muted);
}

/* ====== Таббар ====== */
.tabbar{ position:fixed; left:0; right:0; bottom:0; z-index:var(--z-tabbar); padding-bottom:max(8px, var(--safe)); background:transparent; pointer-events:none; }
.tabbar-inner{ pointer-events:auto; margin:0 18px; height:76px; border-radius:28px; background:#1f1e1e; box-shadow:0 10px 40px rgba(0,0,0,.18); display:flex; align-items:center; justify-content:space-around; gap:6px; padding:0 8px; }
.tab{ position:relative; min-width:64px; height:52px; padding:6px 12px; border-radius:16px; color:#fff; text-decoration:none; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px; font-weight:700; opacity:.9; transition:background .18s ease, opacity .18s ease, transform .08s ease; }
.tab i{ width:26px; height:26px }
.tab span{ font-size:12px; line-height:1; }
.tab:hover{ opacity:1; }
.tab:active{ transform:translateY(1px); }
.tab.active{ background:rgba(255,255,255,.14); opacity:1; }
.badge-wrap{ position:relative }
.badge{
  position:absolute; right:2px; top:-2px;
  background:#ff5966; color:#fff; font-size:11px; line-height:1;
  border-radius:999px; padding:3px 6px; box-shadow:0 2px 10px rgba(0,0,0,.18);
}


.tabbar .btn { height:64px; }

/* SINGLE-FOOTER MODE (CTA внутри таббара) */
.has-cta .cta{ display:none !important; }
body.has-cta{ padding-bottom:calc(var(--safe) + 16px) !important; }
.tabbar-inner.is-cta{ justify-content:stretch; gap:8px; height:72px; border-radius:24px; padding:10px; }
.tabbar-inner.is-cta .tab{ display:none !important; }
.tabbar-inner.is-cta .btn{ height:48px !important; font-size:15px !important; font-weight:800; border-radius:999px; padding:0 14px; box-shadow:none !important; }
body.has-cta .tabbar-inner{ background:#1f1e1e !important; box-shadow:0 10px 40px rgba(0,0,0,.18); }
body.has-cta .tabbar-inner .btn,
body.has-cta .tabbar-inner .btn.primary,
body.has-cta .tabbar-inner .btn.outline{
  background:transparent !important;
  border:1px solid rgba(255,255,255,.22) !important;
  color:#fff !important;
}
body.has-cta .tabbar-inner .btn i,
body.has-cta .tabbar-inner .btn span{ color:#fff !important; }


/* ====== Модалки / тосты (базовые) ====== */
.modal{
  position:fixed; inset:0; display:none; place-items:center;
  background:rgba(0,0,0,.35); padding:12px;
  z-index: var(--z-modal);
}
.modal.show{ display:grid }
.modal-dialog{ width:min(92vw,560px); background:#fff; border-radius:18px; overflow:hidden; box-shadow:var(--shadow) }
.modal-head{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--stroke); font-weight:800 }
.modal-body{ padding:14px; max-height:70vh; overflow:auto; }
.modal-actions{ display:flex; gap:8px; padding:12px 14px; border-top:1px solid var(--stroke); justify-content:flex-end }

.toast-wrap{ position: fixed; top: var(--toast-top, calc(env(safe-area-inset-top, 0px) + 10px)); left:50%; transform:translateX(-50%); width:100%; max-width:100vw; padding:0 14px; display:flex; flex-direction:column; align-items:center; gap:10px; z-index:var(--z-toast); pointer-events:none; }
.toast{ background:#121111; color:#fff; padding:10px 12px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.2); transition:opacity .25s ease; }

/* Тост «Dynamic Island» (top-center) */
.toast.island{
  pointer-events:auto; display:inline-flex; align-items:center; gap:10px;
  max-width:min(520px, 92vw); padding:12px 16px; border-radius:999px; font-weight:800;
  background:linear-gradient(180deg, rgba(255,255,255,.86) 0%, rgba(255,255,255,.70) 100%);
  backdrop-filter:saturate(1.2) blur(10px); -webkit-backdrop-filter:saturate(1.2) blur(10px);
  border:1px solid rgba(255,255,255,.65);
  box-shadow:0 16px 44px rgba(0,0,0,.20), inset 0 1px 0 rgba(255,255,255,.40);
  color:var(--text);
  transform: translateY(-10px) scale(.98); opacity:0;
  transition: transform .22s ease, opacity .22s ease;
}
.toast.island.show{ transform:translateY(0) scale(1); opacity:1; }
.toast.island.hide{ transform:translateY(-8px) scale(.98); opacity:0; }
.toast.island i,[data-lucide]{ width:22px; height:22px; }

@media (prefers-color-scheme: dark){
  .toast.island{
    background:linear-gradient(180deg, rgba(255,255,255,.80) 0%, rgba(255,255,255,.62) 100%);
    border-color:rgba(255,255,255,.50);
  }
}

/* ====== Профиль / аккаунт ====== */
.account-card{
  margin:10px 18px 16px;
  display:flex; align-items:center; gap:12px;
  padding:12px; border:1px solid var(--stroke); border-radius:16px; background:#fff;
}
.avatar{
  width:56px; height:56px; border-radius:999px;
  display:grid; place-items:center;
  background:#121111; color:#fff; font-weight:800; font-size:20px;
}
.account-card .info .name{ font-weight:800; font-size:18px; }
.account-card .info .muted{ color:var(--muted); font-size:14px; margin-top:2px; }

.menu{ display:grid; gap:8px; margin:0 18px 18px; }
.menu-item{
  display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:12px;
  padding:12px; border:1px solid var(--stroke); border-radius:14px; background:#fff;
  text-decoration:none; color:inherit;
}
.menu-item i{ width:22px; height:22px; }
.menu-item .chev{ opacity:.7; }

.addr-list{ display:grid; gap:10px; margin:0 18px 12px; }
.addr{
  display:grid; grid-template-columns:auto 1fr; gap:10px; align-items:center;
  padding:12px; border:1px solid var(--stroke); border-radius:14px; background:#fff;
}
.addr input[type="radio"]{ width:18px; height:18px; accent-color:#121111; align-self:center; margin:0; vertical-align:middle; }
.addr-title{ font-weight:800; }
.addr-sub{ color:var(--muted); font-size:14px; margin-top:2px; overflow-wrap:anywhere; }

.addr-actions{ display:flex; gap:8px; justify-content:flex-start; align-items:center; margin:0 18px 18px; }

/* ====== Мини-трекинг (клиент) ====== */
.track-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.track-caption{ color:var(--muted); font-size:13px; }
.progress-bar{ height:6px; background:#eee; border-radius:999px; overflow:hidden; }
.progress-bar b{ display:block; height:100%; background:#121111; width:0%; }

.progress-list{ border:1px solid var(--stroke); border-radius:12px; background:#fff; }
.progress-item{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-bottom:1px solid var(--stroke); }
.progress-item:last-child{ border-bottom:none; }
.progress-dot{ width:10px; height:10px; border-radius:50%; background:#ddd; }
.progress-item.is-done .progress-dot{ background:#121111; }
.progress-item.is-current .progress-dot{ background:#121111; box-shadow:0 0 0 4px rgba(18,17,17,.08); }
.progress-label{ font-weight:700; }

/* ====== Zoom overlay ====== */
.zoom-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; z-index:1000; }
.zoom-overlay.show{ display:block; }
.zoom-stage{ position:absolute; inset:0; display:grid; place-items:center; }
#zoomImg{ max-width:96vw; max-height:92vh; will-change:transform; touch-action:none; }
.zoom-close{
  position:absolute; right:14px; top:14px;
  width:44px; height:44px; border:none; border-radius:12px;
  display:grid; place-items:center; background:#fff; color:#121111;
  box-shadow:0 8px 24px rgba(0,0,0,.2); cursor:pointer;
}
.zoom-close i{ width:22px; height:22px }

/* ====== Admin mode toggle ====== */
body.admin-mode .app-header,
body.admin-mode .section-search,
body.admin-mode #catChips,
body.admin-mode #activeFilters{ display:none !important; }
body.admin-mode .tabbar{ display:none !important; }

/* ====== ADMIN UI ====== */
.admin-shell{ padding:0 0 18px; }
.admin-head{ display:flex; align-items:center; justify-content:space-between; padding:8px 18px 6px; border-bottom:1px solid var(--stroke); }
.admin-title{ display:flex; gap:8px; align-items:center; font-weight:800; font-size:18px; }
.admin-title i{ width:22px; height:22px; }

/* Вкладки */
.admin-tabs{
  display:flex; gap:8px; padding:10px 18px 6px; overflow-x:auto; -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
.admin-tabs::-webkit-scrollbar{ display:none; }
.admin-tab{
  border:1px solid var(--stroke); background:#fff; color:#000;
  border-radius:999px; padding:10px 14px; font-weight:800; white-space:nowrap; cursor:pointer;
}
.admin-tab.is-active{ background:#121111; color:#fff; border-color:#121111; }

/* Пустое состояние */
.admin-empty{
  margin:12px 18px 0; padding:18px; display:flex; flex-direction:column; gap:8px; align-items:center;
  border:1px dashed var(--stroke); border-radius:14px; background:#fff; color:var(--muted);
}
.admin-empty i{ width:24px; height:24px; }

/* Список: мини-карточки */
.admin-list-mini{ display:grid; gap:10px; margin:10px 18px 18px; }
.order-mini{
  display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center;
  padding:12px; border:1px solid var(--stroke); border-radius:14px; background:#fff; outline:none;
}
.order-mini:focus{ box-shadow:0 0 0 2px rgba(18,17,17,.12) inset; }
.order-mini__left{ min-width:0; }
.order-mini__sum{ font-weight:800; font-size:18px; line-height:1.2; }
.order-mini__meta{ display:flex; gap:8px; margin-top:6px; color:var(--muted); font-size:13px; flex-wrap:wrap; }
.chip-id,.chip-user{
  display:inline-flex; align-items:center; padding:6px 10px; border-radius:999px;
  background:#f6f6f6; border:1px solid var(--stroke);
}
.order-mini__right{ display:flex; align-items:center; gap:10px; }
.order-mini .arrow{ width:18px; height:18px; border-right:2px solid #bbb; border-bottom:2px solid #bbb; transform:rotate(-45deg); margin-left:2px; }

/* Детальная карточка */
.order-detail{ padding:10px 18px 0; display:grid; gap:14px; }
.order-detail__top{ display:grid; grid-template-columns:auto 1fr; gap:10px; align-items:center; }
.btn-ghost{
  height:40px; display:inline-flex; align-items:center; gap:8px; padding:0 12px;
  border-radius:12px; border:1px solid var(--stroke); background:#fff; cursor:pointer;
}
.btn-ghost i{ width:18px; height:18px; }
.order-detail__title{ font-weight:800; font-size:18px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.order-detail__body{ display:grid; gap:14px; }
.kv{ display:grid; gap:6px; }
.kv__row{ display:grid; grid-template-columns:140px 1fr; gap:8px; align-items:start; }
.kv__row dt{ color:var(--muted); font-size:13px; line-height:1.4; }
.kv__row dd{ margin:0; font-size:14px; line-height:1.45; overflow-wrap:anywhere; }
.order-detail__actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

.stage-list{
  display:flex; gap:8px; flex-wrap:wrap;
  border:1px dashed var(--stroke); border-radius:14px; padding:8px;
  background:#fff;
}
.stage-btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  height:40px; padding:0 14px; border-radius:999px; border:1px solid var(--stroke);
  background:#fff; font-weight:800; cursor:pointer;
}
.stage-btn.is-active{ background:#121111; color:#fff; border-color:#121111; }
.mini{ font-size:12px; }

/* Admin receipt actions (размеры) */
.receipt-actions{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
.btn--sm{ height:36px; font-size:14px; font-weight:800; padding:0 12px; border-radius:12px; width:auto; box-shadow:none; }
.btn--sm i{ width:18px; height:18px }
.btn--outline{ background:#fff; color:#121111; border:1px solid var(--stroke); }
.btn--primary{ background:#121111; color:#fff; border:1px solid #121111; }
@media (max-width: 380px){ .receipt-actions .btn--sm{ flex:1 0 auto; } }

/* ====== Кнопка «вверх» — glass, над таббаром ====== */
#scrollTopBtn{
  position: fixed;
  right: 14px;
  bottom: calc(var(--tabbar-h) + var(--safe) + var(--scrolltop-gap));
  width:56px; height:56px; border-radius:999px;
  display:grid; place-items:center;
  background: linear-gradient(180deg, rgba(255,255,255,.78) 0%, rgba(255,255,255,.62) 100%);
  backdrop-filter:saturate(1.2) blur(10px);
  -webkit-backdrop-filter:saturate(1.2) blur(10px);
  border: 1px solid rgba(255,255,255,.65);
  box-shadow: 0 10px 30px rgba(0,0,0,.14), inset 0 1px 0 rgba(255,255,255,.35);
  color: var(--text);
  z-index: var(--z-scrolltop);
  transition: transform .18s ease, opacity .18s ease, box-shadow .18s ease;
  will-change: transform, opacity;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
}
#scrollTopBtn i,#scrollTopBtn svg{ width:22px; height:22px; stroke:currentColor; fill:none; }
#scrollTopBtn[hidden]{ opacity:0; pointer-events:none; transform:translateY(8px); }
@media (hover:hover){ #scrollTopBtn:hover{ box-shadow: 0 14px 36px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.42); } }
#scrollTopBtn:active{ transform: translateY(1px); }
#scrollTopBtn:focus-visible{ outline:2px solid #121111; outline-offset:3px; }
@media (max-width:380px){ #scrollTopBtn{ right:10px; width:52px; height:52px; } }
@media (prefers-color-scheme: dark){
  #scrollTopBtn{
    background: linear-gradient(180deg, rgba(255,255,255,.72) 0%, rgba(255,255,255,.56) 100%);
    border-color: rgba(255,255,255,.52);
    box-shadow: 0 12px 34px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.28);
  }
}
body.admin-mode #scrollTopBtn{ display:none !important; }

/* ====== Global Loader — «9 линий» (замена орбите) ====== */
#globalLoader[hidden]{ display:none !important; }
#globalLoader{ position:fixed; inset:0; z-index:9999; display:grid; place-items:center; }
#globalLoader .gl__backdrop{
  position:absolute; inset:0;
  background: rgba(17,17,17,.18);
  backdrop-filter: blur(6px) saturate(1.1);
  -webkit-backdrop-filter: blur(6px) saturate(1.1);
}
@media (prefers-color-scheme:dark){ #globalLoader .gl__backdrop{ background: rgba(6,10,18,.28); } }

#globalLoader .gl__box{
  position:relative; min-width: 220px; padding: 20px 18px 16px; border-radius:18px;
  border: 1px solid var(--stroke, rgba(15,23,42,.14));
  background: linear-gradient(180deg, rgba(255,255,255,.92) 0%, rgba(255,255,255,.86) 100%);
  box-shadow: 0 20px 50px rgba(0,0,0,.25);
  display:flex; flex-direction:column; align-items:center; gap:12px;
  transform: translateY(8px); opacity:0; transition: transform .18s ease, opacity .18s ease;
  color: var(--text, #121111); text-align:center;
}
@media (prefers-color-scheme:dark){
  #globalLoader .gl__box{
    background: linear-gradient(180deg, rgba(14,18,26,.94) 0%, rgba(14,18,26,.90) 100%);
    color:#fff;
  }
}
#globalLoader.is-visible .gl__box{ transform:translateY(0); opacity:1; }

#globalLoader .gl__spinner{
  display:flex; justify-content:center; align-items:center;
  width:auto; min-width:0; margin:0 auto;
}
#globalLoader .gl__lines{
  display:grid; grid-auto-flow:column; grid-auto-columns:2px; column-gap:4px;
  justify-content:center; align-items:end; line-height:0;
}
#globalLoader .gl__line{
  width:2px; height:16px; display:block; background:currentColor; border-radius:2px;
  transform-origin: bottom center; backface-visibility:hidden; -webkit-backface-visibility:hidden;
  will-change: transform, opacity;
  animation: gl-line-bounce 1000ms ease-in-out infinite;
}
#globalLoader .gl__line.l1 { animation-delay: 800ms; }
#globalLoader .gl__line.l2 { animation-delay: 600ms; }
#globalLoader .gl__line.l3 { animation-delay: 400ms; }
#globalLoader .gl__line.l4 { animation-delay: 200ms; }
#globalLoader .gl__line.l5 { animation-delay:   0ms; }
#globalLoader .gl__line.l6 { animation-delay: 200ms; }
#globalLoader .gl__line.l7 { animation-delay: 400ms; }
#globalLoader .gl__line.l8 { animation-delay: 600ms; }
#globalLoader .gl__line.l9 { animation-delay: 800ms; }

@keyframes gl-line-bounce{
  0%,100%{ opacity:1; transform: scaleY(1); }
  50%    { opacity:.33; transform: scaleY(0.72); }
}

#globalLoader .gl__bar{ width:100%; height:6px; border-radius:999px; background:rgba(0,0,0,.06); overflow:hidden; display:none; }
#globalLoader.has-progress .gl__bar{ display:block; }
#globalLoader .gl__bar > b{ display:block; height:100%; width:0%; background: linear-gradient(90deg, #121111, #4b4b4b); transition: width .2s ease; }
@media (prefers-color-scheme:dark){ #globalLoader .gl__bar{ background: rgba(255,255,255,.14); } #globalLoader .gl__bar > b{ background: linear-gradient(90deg, #ffffff, #cfcfcf); } }
#globalLoader .gl__text{ font-weight:700; font-size:14px; opacity:.92; }

/* Компактная версия */
#globalLoader .gl__box.gl--compact, #globalLoader.gl--compact .gl__box{ padding:14px 12px 12px; min-width:170px; }
#globalLoader .gl__box.gl--compact .gl__spinner, #globalLoader.gl--compact .gl__spinner{ }
#globalLoader .gl__box.gl--compact .gl__line, #globalLoader.gl--compact .gl__line{ }

/* ====== Адаптив ====== */
@media (max-width: 920px){ .kv__row{ grid-template-columns:120px 1fr; } }
@media (max-width: 720px){
  .order-detail__top{ grid-template-columns:1fr auto; }
  .order-detail__title{ grid-column:1 / -1; }
  .kv__row{ grid-template-columns:108px 1fr; }
}
@media (max-width: 480px){
  .admin-head{ padding:8px 12px 6px; }
  .admin-tabs{ padding:10px 12px 6px; }
  .admin-list-mini{ margin:10px 12px 16px; }
  .order-detail{ padding:10px 12px 0; }
  .kv__row{ grid-template-columns:96px 1fr; }
  .order-mini__sum{ font-size:17px; }
  .cashback-box .row{ grid-template-columns:1fr; }
  .cashback-box .btns{ justify-content:flex-end; }
}
@media (max-width: 380px){
  .grid{ grid-template-columns:1fr; }
  .p-title{ font-size:28px }
  .btn{ height:58px; font-size:16px }
  .thumb{ width:64px; height:64px }
  .real-photos{ grid-template-columns:1fr 1fr; }
  .tabbar-inner{ height:72px; }
  .tab{ height:50px; }
  .cart-img{ width:64px; height:64px; }
  .checkout .cart-row{ grid-template-columns:64px minmax(0,1fr) max-content; }
}

/* ====== Производительность: быстрый mount секций ====== */
#view > * { content-visibility: auto; contain-intrinsic-size: 800px; }
.admin-list-mini, .product-grid, .orders-list { content-visibility: auto; contain-intrinsic-size: 1200px; }
/* === HOTFIX 2025-10-30 =========================================
   1) Кнопки hero (назад/избранное) снова поверх кадра, в углах
   2) Разметка «Мои заказы» — нормальная сетка, не сплющивается
   3) Стрелка «вверх» в тёмной теме — белая
================================================================= */

/* 1) PRODUCT: кнопки поверх главного изображения (верхние углы) */
.gallery-main { position: relative; } /* на случай, если переопределили выше */
.gallery-main .hero-btn{
  position: absolute;
  top: 12px;
  z-index: 3;
}
.gallery-main .hero-back{ left: 12px; }
.gallery-main .hero-fav { right: 12px; }
@media (max-width: 380px){
  .gallery-main .hero-btn{ top: 8px; }
}

/* 2) ORDERS: нормальная сетка карточек и типографика */
.orders-groups{ display:grid; gap:14px; }
.orders-group .subsection-title{ font-weight:800; margin:8px 0 6px; }

.order-row{
  display:grid;
  grid-template-columns: 72px minmax(0,1fr) max-content;
  gap:14px; align-items:center;
  padding:12px 0;
  border-bottom:1px solid var(--stroke);
}
.order-row .cart-img{ width:72px; height:72px; border-radius:16px; overflow:hidden; }
.order-row .cart-img img{ width:100%; height:100%; object-fit:cover; display:block; }
.order-row .cart-title{
  font-weight:800; font-size:18px;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.order-row .cart-sub{ color:var(--muted); font-size:14px; margin-top:2px; overflow-wrap:anywhere; }
.order-row .cart-price{ font-weight:800; }
.order-row .pill{ white-space:nowrap; }

@media (max-width: 380px){
  .order-row{
    grid-template-columns: 64px minmax(0,1fr) auto;
  }
  .order-row .cart-img{ width:64px; height:64px; }
}

/* 3) SCROLL-TOP: белая иконка в dark-теме */
@media (prefers-color-scheme: dark){
  #scrollTopBtn{ color:#fff !important; }
}
/* === [FIX] Topbar + Search Row (Telegram safe, single line) === */

/* Статичный хедер всегда в слое и в видимой области */
.app-header{
  position: sticky;
  top: var(--safe-top, 0px);
  z-index: 110;              /* выше сеток и карточек, ниже product-fixhdr (120) */
  display: flex;
  align-items: center;
  justify-content: space-between;
  /* Подложка, чтобы не «просвечивало» при скролле */
  background: var(--paper, #fff);
  -webkit-backdrop-filter: saturate(1.2) blur(6px);
  backdrop-filter: saturate(1.2) blur(6px);
}

/* Ряд «поиск + кнопка фильтра» всегда в одну линию */
.section-search{
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px 0;
}

/* Блок с инпутом должен уметь сжиматься, иначе кнопка падает на вторую строку */
.section-search .search-wrap{
  flex: 1 1 auto;
  min-width: 0;                  /* критично! разрешает сжиматься внутри flex */
  position: relative;
}
.section-search .search{
  width: 100%;
  padding-right: 44px;           /* под кнопку камеры */
}
.section-search .search-ico{
  position: absolute;
  left: 10px; top: 50%; transform: translateY(-50%);
}

/* Кнопка фильтров фиксированной ширины — не переносимая */
#openFilters{
  flex: 0 0 auto;
  width: 44px;
  height: 44px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
}

/* На случай очень узких экранов — чуть уменьшим зазор */
@media (max-width: 360px){
  .section-search{ gap: 8px; padding-left: 12px; padding-right: 12px; }
}
/* === FIX: Search row stays on one line === */
.section-search{
  display:flex;              /* на всякий случай переопределим */
  align-items:center;
  gap:10px;
  flex-wrap:nowrap;          /* <— ключ: запрещаем перенос */
}

.section-search .search-wrap{
  flex:1 1 auto;
  min-width:0;               /* <— критично, чтобы инпут ужимался */
}

.square-btn,
#openFilters{
  flex:0 0 44px;             /* <— фиксируем ширину кнопки фильтра */
  max-width:44px;
  min-width:44px;
  flex-shrink:0;             /* и запрещаем сжатие самой кнопки */
}


/* на случай, если где-то остался .hidden */
.tg-webapp .app-header.hidden{
  opacity:1 !important;
  transform:none !important;
  visibility:visible !important;
}
/* === HARD-FIX: search row single-line, no wrap (final authority) === */
.section.section-search{
  display:flex !important;
  align-items:center !important;
  gap:10px !important;
  flex-wrap:nowrap !important;     /* запрещаем перенос */
  min-width:0 !important;          /* контейнер сам может сжиматься */
}

.section.section-search .search-wrap{
  flex:1 1 auto !important;
  min-width:0 !important;          /* критично: позволяет инпуту ужиматься */
  position:relative;
}

.section.section-search .search{
  width:100% !important;
  min-width:0 !important;
  padding-right:44px !important;   /* место под кнопку камеры */
}

#openFilters{
  flex:0 0 44px !important;        /* фиксированная ширина */
  width:44px !important;
  height:44px !important;
  max-width:44px !important;
  min-width:44px !important;
  flex-shrink:0 !important;         /* не даём сжиматься */
}

/* на очень узких экранах немного уменьшим зазор */
@media (max-width:360px){
  .section.section-search{ gap:8px !important; }
}
/* === FIX: product fixed header must be above everything === */
:root{
  /* было 80 — ниже app-header:110 */
  --z-fixhdr: 140;
}

/* принудительно выше любых локальных слоёв/трансформов */
#productFixHdr,
.product-fixhdr{
  z-index: var(--z-fixhdr) !important;
  isolation: isolate;               /* собственный контекст, чтобы ничего не "пробивало" */
  pointer-events: none;             /* контейнер не ловит клики... */
}
#productFixHdr .fixbtn,
.product-fixhdr .fixbtn{
  pointer-events: auto;             /* ...а кнопки ловят */
}

/* на всякий пожарный — если где-то есть агрессивные стили */
.app-header.hidden{
  opacity: 0;
  visibility: hidden;               /* исключаем перекрытие "невидимым" хедером */
  pointer-events: none;
}
/* === OVERRIDE: разрешаем прятать статичный .app-header в Telegram === */
.tg-webapp .app-header.hidden{
  opacity: 0 !important;
  transform: translateY(-8px) !important;
  visibility: hidden !important;
  pointer-events: none !important;
}
/* === Product: небольшой отступ от верхней границы экрана === */
/* Учитываем вырез/статус-бар через --safe-top, чтобы на iOS/Android не залипало под челку */
.product{
  padding-top: calc(10px + var(--safe-top));
}

@media (max-width: 380px){
  .product{ padding-top: calc(8px + var(--safe-top)); }
}
/* === SCROLL-TOP tune (вставь/обнови в styles.css) === */
:root{
  /* было: 26px */
  --scrolltop-gap: 8px; /* ниже — ближе к таббару */
}

/* при желании — чуть “стекляннее” блик (не обязательно) */
#scrollTopBtn{
  background: linear-gradient(180deg, rgba(255,255,255,.82) 0%, rgba(255,255,255,.66) 100%);
  backdrop-filter: saturate(1.2) blur(12px);
  -webkit-backdrop-filter: saturate(1.2) blur(12px);
  border: 1px solid rgba(255,255,255,.70);
  box-shadow: 0 12px 36px rgba(0,0,0,.16), inset 0 1px 0 rgba(255,255,255,.40);
}

/* уже есть в твоём файле, но на всякий — иконка белая в dark */
@media (prefers-color-scheme: dark){
  #scrollTopBtn{ color:#fff !important; }
}
/* === ScrollTop: иконка темнее, идеально по центру, кнопка левее === */

/* смещаем кнопку на пару пикселей ближе к центру */
#scrollTopBtn{
  right: 10px !important; /* было 14px */
}

/* на очень узких экранах — ещё на пиксель-два */
@media (max-width: 380px){
  #scrollTopBtn{ right: 8px !important; }  /* было 10px */
}

/* делаем саму стрелку заметнее на светлом фоне и выравниваем */
#scrollTopBtn i,
#scrollTopBtn svg{
  width: 22px;
  height: 22px;
  display: block;              /* убираем inline-baseline люфт */
  stroke: currentColor;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
  stroke-width: 2.25;          /* чуть толще линии, лучше читается */
  transform: translateY(-0.5px); /* микро-юстировка по оптике */
  pointer-events: none;
}

/* светлая тема: тёмная стрелка (чётко на белом стекле) */
#scrollTopBtn{
  color: #1a1a1a;              /* темнее var(--text), лучше контраст */
}

/* тёмная тема: стрелка остаётся белой */
@media (prefers-color-scheme: dark){
  #scrollTopBtn{ color:#fff !important; }
}
/* === ScrollTop (final override): контраст, центрирование, сдвиг === */

/* чутка левее и гарантированное центрирование для flex/grid */
#scrollTopBtn{
  right: 10px !important;                 /* было 14px */
  align-items: center !important;         /* центрирование при display:flex */
  justify-content: center !important;     /* центрирование при display:flex */
  color: #1a1a1a !important;              /* заметная стрелка в светлой теме */
}

/* очень узкие экраны: ещё на пару пикселей */
@media (max-width: 380px){
  #scrollTopBtn{ right: 8px !important; }
}

/* сама иконка — без базовой линии, толще штрих и микро-юстировка */
#scrollTopBtn i,
#scrollTopBtn svg{
  width: 22px;
  height: 22px;
  display: block;                          /* убирает baseline-люфт */
  stroke: currentColor !important;
  fill: none !important;
  stroke-linecap: round !important;
  stroke-linejoin: round !important;
  stroke-width: 2.4 !important;            /* толще, заметнее */
  transform: translateY(-0.5px);           /* оптический центр */
  pointer-events: none;
}

/* тёмная тема — стрелка белая (поверх «стекла») */
@media (prefers-color-scheme: dark){
  #scrollTopBtn{ color:#fff !important; }
}
/* === SCROLLTOP — финальный оверрайд контраста и позиции === */

/* двигаем кнопку ЛЕВЕЕ от правого края (right больше) и задаём явный цвет */
html body #scrollTopBtn{
  right: 22px !important;            /* было 10–14px → теперь заметно левее */
  color: #121111 !important;         /* светлая тема — чёрная стрелка */
  align-items: center !important;     /* идеальное центрирование */
  justify-content: center !important;
}

/* очень узкие экраны — чуть меньше вынос */
@media (max-width: 380px){
  html body #scrollTopBtn{ right: 18px !important; }
}

/* сама иконка: толще штрих, без fill, строго currentColor */
html body #scrollTopBtn svg,
html body #scrollTopBtn i{
  display: block !important;          /* убирает baseline-люфт */
  stroke: currentColor !important;
  fill: none !important;
  stroke-linecap: round !important;
  stroke-linejoin: round !important;
  stroke-width: 2.4 !important;       /* контрастнее */
  transform: translateY(-0.5px);      /* оптический центр */
  pointer-events: none;
}

/* тёмная тема — оставляем белую стрелку */
@media (prefers-color-scheme: dark){
  html body #scrollTopBtn{ color:#fff !important; }
}
/* === ScrollTop: принудительно чёрная стрелка (поверх всех тем) === */
html body #scrollTopBtn{
  color:#121111 !important;           /* базовый цвет элемента */
}

/* красим именно линии иконки, чтобы не зависеть от currentColor */
html body #scrollTopBtn svg,
html body #scrollTopBtn svg *,
html body #scrollTopBtn i{
  stroke: #121111 !important;         /* чёрный штрих */
  fill: none !important;
  stroke-linecap: round !important;
  stroke-linejoin: round !important;
  stroke-width: 2.4 !important;
}

/* если где-то выше остались правила "в тёмной теме сделать белым" — глушим их */
@media (prefers-color-scheme: dark){
  html body #scrollTopBtn{ color:#121111 !important; }
  html body #scrollTopBtn svg,
  html body #scrollTopBtn svg *,
  html body #scrollTopBtn i{ stroke:#121111 !important; }
}
/* === FIX: уведомления кликаются — контейнер фикс-хедера сквозной === */
#productFixHdr,
.product-fixhdr{
  pointer-events: none !important;      /* контейнер не ловит клики */
}

#productFixHdr .fixbtn,
.product-fixhdr .fixbtn{
  pointer-events: auto !important;      /* но сами кнопки ловят */
}

/* дома/не на карточке товара — вообще убираем слой */
html.route-home #productFixHdr,
html.route-home .product-fixhdr{
  display: none !important;
}
/* === Filters UI (modal + active chips) =================================== */
.filters-modal{ display:grid; gap:12px; }
.filters-hint{
  margin:2px 2px 4px; font-size:13px; color:var(--muted);
}

.filters-card{
  border:1px solid var(--stroke);
  border-radius:16px;
  background:#fff;
  overflow:hidden;
}
.filters-card__head{
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  padding:10px 12px; border-bottom:1px solid var(--stroke);
  background: linear-gradient(180deg, #fafafa 0%, #f8f8f8 100%);
}
.filters-card__title{ font-weight:800; }
.filters-card__meta{ color:var(--muted); font-size:12px; }
.filters-card__body{ padding:10px 12px 12px; }
.filters-card .chipbar{ padding:2px 0 0 0; }

.filters-note{
  margin-top:8px; font-size:12px; color:var(--muted);
}

/* selectable chip + свотч цвета */
.chip--select{
  border-radius:14px;
  transition: transform .06s ease, box-shadow .12s ease, background .18s ease;
}
.chip--select:active{ transform: translateY(1px); }
.chip--select.active{ background:#121111; color:#fff; border-color:#121111; }
.chip--select .swatch{
  width:14px; height:14px; border-radius:50%;
  border:1px solid rgba(0,0,0,.12);
  background: var(--sw, #000);
  display:inline-block;
}

/* нижняя строка в модалке */
.filters-inline{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:4px 2px 0;
}
.toggle{ display:inline-flex; align-items:center; gap:10px; }
.toggle input[type="checkbox"]{
  width:18px; height:18px; accent-color:#121111; margin:0;
}
.pill--ghost{
  background:#fff; color:var(--text);
  border:1px solid var(--stroke);
}
.pill--ghost .i-x{ width:16px; height:16px; display:inline-block; }

/* активные фильтры над лентой */
#activeFilters{
  display:flex; flex-wrap:wrap; gap:8px; padding:8px 18px 0;
}
.filter-chip{
  position:relative; padding-right:32px;
}
.filter-chip .chip-x{
  position:absolute; right:8px; top:50%; transform:translateY(-50%);
  width:18px; height:18px; border-radius:50%;
  display:grid; place-items:center;
  background:rgba(0,0,0,.06);
  font-weight:800; line-height:1; cursor:pointer;
}
.filter-chip .chip-x:hover{ background:rgba(0,0,0,.10); }

.pill--clear-all{
  margin-left:auto;
}

/* маленькие иконки-заглушки (чтобы не тянуть svg): */
.i-x::before{
  content: "✕";
  font-weight:800;
  display:inline-block;
  transform: translateY(-.5px);
}
/* === Filters UI (compact, wrap, correct swatches) =================== */

/* модалка: гарантированно помещается на экран */
.modal-dialog{
  max-height: 86vh;                 /* было 70vh только для body */
  display: flex;
  flex-direction: column;
}
.modal-head{ flex: 0 0 auto; }
.modal-body{
  flex: 1 1 auto;
  max-height: none !important;      /* чтобы работал flex-скролл */
  overflow: auto;
}
.modal-actions{ flex: 0 0 auto; }

/* карточки секций в модалке */
.filters-modal{ display:grid; gap:12px; }
.filters-hint{ margin:2px 2px 4px; font-size:13px; color:var(--muted); }
.filters-card{
  border:1px solid var(--stroke); border-radius:16px; background:#fff; overflow:hidden;
}
.filters-card__head{
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  padding:10px 12px; border-bottom:1px solid var(--stroke);
  background:linear-gradient(180deg, #fafafa 0%, #f7f7f7 100%);
}
.filters-card__title{ font-weight:800; }
.filters-card__meta{ color:var(--muted); font-size:12px; }
.filters-card__body{ padding:10px 12px 12px; }

/* чип-бары: перенос по строкам, ровные зазоры — ничего не "липнет" */
.chipbar--wrap{
  display:flex; flex-wrap:wrap;
  gap:8px 8px;                      /* вертикальный и горизонтальный */
  overflow: visible;                /* снимаем горизонтальный скролл */
  padding-bottom: 0;
}

/* чипы и свотчи */
.chip--select{
  display:inline-flex; align-items:center; gap:8px;
  border-radius:14px;
  transition: transform .06s ease, box-shadow .12s ease, background .18s ease;
}
.chip--select:active{ transform: translateY(1px); }
.chip--select.active{ background:#121111; color:#fff; border-color:#121111; }
.chip--select .swatch{
  width:14px; height:14px; border-radius:50%;
  border:1px solid rgba(0,0,0,.12);
  background: var(--sw, #121111);
}

/* нижняя строка в модалке */
.filters-inline{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:4px 2px 0;
}
.toggle{ display:inline-flex; align-items:center; gap:10px; }
.toggle input[type="checkbox"]{ width:18px; height:18px; accent-color:#121111; margin:0; }
.pill--ghost{ background:#fff; color:var(--text); border:1px solid var(--stroke); }
.i-x::before{ content:"✕"; font-weight:800; display:inline-block; transform:translateY(-.5px); }

/* активные пилюли над лентой: многорядная сетка с gap */
#activeFilters{
  display:flex; flex-wrap:wrap; gap:8px; padding:8px 18px 0;
}
.filter-chip{ position:relative; padding-right:30px; }
.filter-chip .chip-x{
  position:absolute; right:8px; top:50%; transform:translateY(-50%);
  width:18px; height:18px; border-radius:50%;
  display:grid; place-items:center;
  background:rgba(0,0,0,.06); font-weight:800; line-height:1; cursor:pointer;
}
.filter-chip .chip-x:hover{ background:rgba(0,0,0,.10); }

/* кнопка «Сбросить фильтры» прилипает вправо при наличии места */
.pill--clear-all{ margin-left:auto; }
/* === Filters (modal): one-line rows with horizontal scroll === */
.chipbar--scroll{
  display: flex;
  flex-wrap: nowrap;             /* одна строка */
  gap: 10px;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
  padding-bottom: 6px;           /* небольшой отступ под скролл */
}
.chipbar--scroll .chip{
  flex: 0 0 auto;                /* не сжимать, листаем вправо */
}
/* === [Filters Active Pills] single-line scroll & distinct style === */
#activeFilters{
  display: flex !important;
  flex-wrap: nowrap !important;      /* одна строка */
  gap: 8px !important;
  padding: 8px 18px 0 !important;
  overflow-x: auto !important;       /* горизонтальная прокрутка */
  overflow-y: hidden !important;
  -webkit-overflow-scrolling: touch !important;
  scrollbar-width: thin;
}

#activeFilters .filter-pill{
  flex: 0 0 auto;                    /* не сжимать, листаем вправо */
  background: #fff;
  border: 1px solid var(--stroke);
  color: var(--text);
  border-radius: 999px;
  padding: 10px 32px 10px 14px;      /* место под крестик */
  font-weight: 800;
}

#activeFilters .filter-pill .chip-x{
  position: absolute;
  right: 8px; top: 50%; transform: translateY(-50%);
  width: 18px; height: 18px; border-radius: 50%;
  display: grid; place-items: center;
  background: rgba(0,0,0,.06);
  font-weight: 800; line-height: 1; cursor: pointer;
}
#activeFilters .filter-pill .chip-x:hover{ background: rgba(0,0,0,.10); }

/* кнопка «Сбросить фильтры» визуально в том же стиле и тоже скроллится */
#activeFilters .pill--clear-all{
  flex: 0 0 auto;
}
/* === MINI PATCH: корректная иерархия слоёв для затемнения === */
:root{
  /* хедер ниже модалки/затемнения, но выше контента */
  --z-app-header: 60;
  --z-scrolltop: 120;
  --z-fixhdr: 140;  /* фикс-хедер товара поверх обычного */
  --z-toast: 150;
  --z-modal: 200;   /* модалка/затемнение — САМЫЙ верхний слой */
}

/* принудительно вернуть хедер к переменной (ранний хотфикс ставил 110) */
.app-header{ z-index: var(--z-app-header) !important; }

/* модалка/затемнение поверх всего */
.modal{ z-index: var(--z-modal) !important; }
/* === HOTFIX: уведомления в .app-header кликаются на всех страницах === */

/* 1) Хедер — свой стек + выше контента */
.app-header{
  isolation: isolate;             /* свой stacking context */
  z-index: 130 !important;        /* выше сеток/героев, ниже фикс-хедера и модалок */
  pointer-events: auto !important;
}

/* 2) Кнопка уведомлений — приоритет внутри хедера */
.hdr-right{ position: relative; z-index: 2; }
#openNotifications{ position: relative; z-index: 3; pointer-events: auto !important; }

/* 3) Фикс-хедер товара не перехватывает клики поверх хедера */
#productFixHdr,
.product-fixhdr{
  pointer-events: none !important;
}
#productFixHdr .fixbtn,
.product-fixhdr .fixbtn{
  pointer-events: auto !important;
}

/* 4) На всякий случай снимаем "слои" с верхних секций контента */
.view,
.product,
.gallery,
.gallery-main{
  position: relative;
  z-index: 0 !important;
}
/* === Favorites page title alignment === */
.page-title{
  /* такие же боковые отступы, как у .view/.grid */
  margin: 10px 18px 14px;        /* ↑чуть больше низ для зазора над сеткой */
  display: flex;
  align-items: center;
  gap: 10px;
}
.page-title .square-btn{
  /* микро-сдвиг стрелки левее, чтобы визуально совпасть с сеткой */
  margin-left: -4px;
}
.page-title h1{
  margin: 0;
  font-weight: 800;
  font-size: 24px;               /* как .section-title */
  line-height: 1.2;
}

/* === Notify dots = cart-badge style (final) ======================= */
:root{
  --dot-size: 10px;         /* компактнее и внятнее */
  --dot-color: #ff5966;     /* тот же красный, что и у бейджа */
  --dot-ring: #ffffff;      /* белое тонкое кольцо как у бейджа */
}
@media (prefers-color-scheme: dark){
  :root{ --dot-ring: #1f1e1e; } /* в тёмной теме кольцо из цвета таббара */
}

/* якоря не режутся */
.tabbar .tab,
.menu .menu-item,
.badge-wrap,
.notif-btn{ position: relative; overflow: visible; }

/* единый стиль точки для .dot и .acc-dot */
:where(.dot, .acc-dot){
  position: absolute;
  top: -3px;
  right: -3px;
  width: var(--dot-size);
  height: var(--dot-size);
  border-radius: 999px;
  background: var(--dot-color);
  box-shadow:
    0 0 0 2px var(--dot-ring),       /* тонкое белое кольцо вокруг, как у бейджа */
    0 2px 8px rgba(0,0,0,.18);
  pointer-events: none;
}

/* точка на табе "Аккаунт" сидит в правом верхнем углу и не смещает подпись */
.tabbar .tab .dot{ top:-2px; right:-2px; }

/* точка в пункте меню — чуть ближе к углу карточки */
.menu .menu-item > .acc-dot{ top:-4px; right:-4px; }

/* сам числовой бейдж корзины — оставить как есть, только синхронизируем цвета при желании */
#cartBadge.badge{
  background:#ff5966; color:#fff;
}

/* (необязательно) круглый индикатор на кнопке уведомлений */
#openNotifications .dot{ top:-4px; right:-4px; }
/* === NEUTRAL UI: единые токены и компоненты ========================= */
:root{
  --neutral-bg:     #f6f6f6;                 /* светлый фон */
  --neutral-fg:     var(--text);             /* текст той же тональности */
  --neutral-border: var(--stroke);           /* тонкая рамка */
  --neutral-hover:  #efefef;                 /* наведение */
  --neutral-press:  #e9e9e9;                 /* нажатие */
  --neutral-shadow: 0 6px 18px rgba(0,0,0,.06); /* мягкая тень */
}

@media (prefers-color-scheme: dark){
  :root{
    --neutral-bg:     rgba(255,255,255,.10);
    --neutral-fg:     #fff;
    --neutral-border: rgba(255,255,255,.18);
    --neutral-hover:  rgba(255,255,255,.14);
    --neutral-press:  rgba(255,255,255,.10);
    --neutral-shadow: 0 8px 26px rgba(0,0,0,.28);
  }
}

/* КНОПКА: .btn.neutral — вторичное действие без агрессивного контраста */
.btn.neutral{
  background: var(--neutral-bg) !important;
  color: var(--neutral-fg) !important;
  border: 1px solid var(--neutral-border) !important;
  box-shadow: var(--neutral-shadow) !important;
}
.btn.neutral:hover{ background: var(--neutral-hover) !important; }
.btn.neutral:active{ transform: translateY(1px); background: var(--neutral-press) !important; }
.btn.neutral:disabled{
  opacity: .55; box-shadow: none; cursor: not-allowed;
}

/* ПИЛЮЛЯ: .pill.neutral — как outline, но с заливкой бумаги */
.pill.neutral{
  background: var(--neutral-bg) !important;
  color: var(--neutral-fg) !important;
  border: 1px solid var(--neutral-border) !important;
}
.pill.neutral:focus-visible{ outline: 2px solid var(--neutral-border); outline-offset: 3px; }

/* ЧИП: .chip.neutral — “пассивный” включаемый фильтр/лейбл */
.chip.neutral{
  background: var(--neutral-bg) !important;
  color: var(--neutral-fg) !important;
  border: 1px solid var(--neutral-border) !important;
}
.chip.neutral.active{
  /* активный нейтральный чип слегка усиливаем, без инверсии в чёрный */
  background: var(--neutral-hover) !important;
  border-color: var(--neutral-border) !important;
  color: var(--neutral-fg) !important;
}

/* КВАДРАТНЫЕ / ИКОН-КНОПКИ (в хедерах и т.п.) */
.square-btn.neutral,
.icon-btn.neutral{
  background: var(--neutral-bg) !important;
  color: var(--neutral-fg) !important;
  border: 1px solid var(--neutral-border) !important;
  box-shadow: var(--neutral-shadow) !important;
}
.square-btn.neutral:active,
.icon-btn.neutral:active{ background: var(--neutral-press) !important; }

/* HERO/FX: круглая плавающая кнопка “нейтральная” (например, кнопка назад) */
.hero-btn.neutral,
#productFixHdr .fixbtn.neutral,
.product-fixhdr .fixbtn.neutral{
  background: var(--neutral-bg) !important;
  color: var(--neutral-fg) !important;
  border: 1px solid var(--neutral-border) !important;
  box-shadow: var(--neutral-shadow) !important;
}

/* Доп: компактный нейтральный вариант для мини-кнопок в админке */
.btn--sm.neutral{
  background: var(--neutral-bg) !important;
  color: var(--neutral-fg) !important;
  border: 1px solid var(--neutral-border) !important;
  box-shadow: none !important;
}
/* === Telegram Top Inset (глобальный отступ сверху) =============== */
:root{
  --safe-top: env(safe-area-inset-top, 0px);
  /* базовая высота «кнопочной» зоны Telegram; можно подстроить 48–60px */
  --tg-topbar: 56px;
}

/* spacer в потоке: даёт контенту отъехать вниз */
#tgTopInset{
  height: 0;         /* по умолчанию — 0 в обычном браузере */
}

/* только внутри Telegram WebApp — добавляем реальный отступ */
.tg-webapp #tgTopInset{
  height: calc(var(--safe-top) + var(--tg-topbar));
}

/* статичный хедер убираем везде на всякий случай */
.app-header{ display:none !important; }

/* секции/контент уже учитывают spacer, не дублируем большие паддинги сверху */
.tg-webapp .section,
.tg-webapp .view,
.tg-webapp .checkout{ 
  /* ничего не добавляем сверху специально — spacer уже вставлен */
}

/* product-экран: маленький внутренний зазор, БЕЗ safe-top — чтобы не удваивать */
.tg-webapp .product{
  padding-top: 8px !important;
}

/* фикс-хедер товара оставляем поверх, кнопки уже учитывают var(--safe-top) */
:root{ --z-fixhdr: 140; }
#productFixHdr, .product-fixhdr{ z-index: var(--z-fixhdr) !important; }
#btnFixBack{ left:12px; top: calc(6px + var(--safe-top)); }
#btnFixFav{  right:12px; top: calc(6px + var(--safe-top)); }
/* === NUDGE: чуть ниже всех верхних fixed-элементов === */
:root{
  --top-ui-nudge: 6px; /* ↑ можно 4–8px по вкусу */
}

/* Кнопки фикс-хедера товара */
#btnFixBack{
  top: calc(6px + var(--top-ui-offset) + var(--top-ui-nudge)) !important;
}
#btnFixFav{
  top: calc(6px + var(--top-ui-offset) + var(--top-ui-nudge)) !important;
}

/* Крестик в zoom-оверлее */
.zoom-close{
  top: calc(14px + var(--top-ui-offset) + var(--top-ui-nudge)) !important;
}



/* Тосты (Dynamic Island) — тоже ниже */
.toast-wrap{
  top: calc(var(--toast-top) + var(--top-ui-nudge)) !important;
}
/* === FIX PACK: top offsets for TG, hero buttons, zoom close, toasts === */

/* 1) Базовые токены (дефолт для обычного браузера) */
:root{
  /* общий оффсет верхнего системного бара (вне TG почти 0) */
  --top-ui-offset: var(--safe-top, 0px);
  /* дополнительная «просадка» по твоей просьбе */
  --top-ui-nudge: 12px;

  /* единый токен для тостов: ПРИНИМАЕМ snake-case как канонический */
  --toast-top: calc(var(--safe-top, 0px) + 10px);
}

/* 2) Внутри Telegram WebApp добавляем высоту телеграм-кнопок */
.tg-webapp:root{
  --top-ui-offset: calc(var(--safe-top, 0px) + var(--tg-topbar, 56px));
  --toast-top:     calc(var(--safe-top, 0px) + var(--tg-topbar, 56px) + 10px);
}

/* 3) Кнопки фикс-хедера товара — ниже и с учётом Telegram */
#btnFixBack{
  top: calc(6px + var(--top-ui-offset) + var(--top-ui-nudge)) !important;
}
#btnFixFav{
  top: calc(6px + var(--top-ui-offset) + var(--top-ui-nudge)) !important;
}



/* 5) Крестик zoom-оверлея — фикс у верхней кромки, не по центру */
.zoom-close{
  top: calc(14px + var(--top-ui-offset) + var(--top-ui-nudge)) !important;
}

/* 6) Тосты (Dynamic Island) — используем новый канонический токен */
.toast-wrap{
  top: var(--toast-top) !important;
}

/* 7) Синхронизируем старое имя переменной с новым */
:root{
  --toastTop: var(--toast-top);
}
/* === Toast offset bump (+8px) === */

/* 1) общий токен-добавка */
:root{
  --toast-nudge: 8px; /* тут увеличиваешь/уменьшаешь отступ для тостов */
}

/* 2) пересобираем --toast-top с учётом nudge */
:root{
  --toast-top: calc(var(--safe-top, 0px) + 10px + var(--toast-nudge));
}

/* 3) внутри Telegram WebApp — тоже прибавляем nudge */
.tg-webapp:root{
  --toast-top: calc(var(--safe-top, 0px) + var(--tg-topbar, 56px) + 10px + var(--toast-nudge));
}

/* 4) маппинг для старого имени переменной (как и было) */
:root{ --toastTop: var(--toast-top); }
/* === FIX: favorites header back button stays inside the screen === */
.page-title{
  padding: 0 18px !important;
  margin: 10px 0 14px !important;
  position: relative;
  display: flex;
  align-items: center;
  min-height: 44px;
  overflow: visible; /* на всякий случай, чтобы иконка не обрезалась */
}

.page-title h1{
  margin: 0 !important;
  font-weight: 800;
  font-size: 24px;
  line-height: 1.2;
}

/* Кнопка: фиксируем по левой «линией контента» и убираем X-сдвиг */
.page-title .square-btn{
  position: absolute !important;
  left: max(18px, calc(env(safe-area-inset-left, 0px) + 12px)) !important;
  top: 50% !important;
  width: 44px; height: 44px;
  transform: translateY(-50%) !important; /* ← удалили translateX */
  display: grid; place-items: center;
  z-index: 1;
}

/* Очень узкие экраны — слегка прижимаем, но не выходим за край */
@media (max-width: 360px){
  .page-title .square-btn{
    left: max(12px, calc(env(safe-area-inset-left, 0px) + 10px)) !important;
  }
}
/* === FIX: отступ под кнопку "назад" в .page-title === */
:root{
  --back-btn-w: 44px;   /* ширина квадратной кнопки */
  --back-btn-gap: 10px; /* зазор между кнопкой и текстом */
}

/* резервируем место слева под кнопку */
.page-title{
  padding-left: calc(18px + var(--back-btn-w) + var(--back-btn-gap)) !important;
}

/* сама кнопка остаётся на «линии контента» */
.page-title .square-btn{
  position: absolute !important;
  left: max(18px, calc(env(safe-area-inset-left, 0px) + 12px)) !important;
  top: 50% !important;
  width: var(--back-btn-w);
  height: var(--back-btn-w);
  transform: translateY(-50%) !important;
  z-index: 1;
}

/* очень узкие экраны — чуть уменьшаем зазор, чтобы тексту было место */
@media (max-width: 360px){
  :root{ --back-btn-gap: 8px; }
  .page-title{ padding-left: calc(12px + var(--back-btn-w) + var(--back-btn-gap)) !important; }
  .page-title .square-btn{
    left: max(12px, calc(env(safe-area-inset-left, 0px) + 10px)) !important;
  }
}
/* === Favorites title: ещё левее (единый токен) === */
:root{
  /* на сколько отступаем слева от края экрана/безопасной зоны */
  --fav-left: 2px; /* было ~18px. Поставь 10px или 8px, если нужно ещё левее */
}

/* резерв под кнопку с новым левым отступом */
.page-title{
  padding-left: calc(var(--fav-left) + var(--back-btn-w) + var(--back-btn-gap)) !important;
}

/* кнопка "назад" прижимается на тот же левый край, но уважает safe-area */
.page-title .square-btn{
  left: max(var(--fav-left), calc(env(safe-area-inset-left, 0px) + 8px)) !important;
}

/* очень узкие экраны — ещё плотнее прижимаем */
@media (max-width: 360px){
  :root{ --fav-left: 10px; } /* можешь сменить на 8px при желании */
}
/* === Skeletons for product grid === */
.card.is-skeleton { pointer-events:none; }
.card.is-skeleton .card-img{ background:#f2f2f2; }
.skel{
  position:relative; overflow:hidden; border-radius:10px; background:#eee;
}
.skel::after{
  content:""; position:absolute; inset:0;
  transform:translateX(-100%);
  background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.6) 50%, rgba(255,255,255,0) 100%);
  animation: skel 1.2s ease-in-out infinite;
}
@keyframes skel{ 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }
.skel-img{ width:100%; height:100%; aspect-ratio:3/4; border-radius:22px; }
.skel-title{ height:18px; width:70%; margin:10px 6px 6px; }
.skel-sub{ height:14px; width:50%; margin:0 6px 8px; }
.skel-price{ height:18px; width:68px; border-radius:8px; }
.skel-chip{ height:18px; width:44px; border-radius:999px; }
/* ====== Производительность: быстрый mount секций ====== */
#view > * { content-visibility: auto; contain-intrinsic-size: 800px; }
.admin-list-mini, .product-grid, .orders-list { content-visibility: auto; contain-intrinsic-size: 1200px; }
/* === Skeleton grid (карточки-заглушки для ленты) =================== */
:root{
  --skel-base: #eee;
  --skel-lite: #f6f6f6;
  --skel-dark: rgba(0,0,0,.06);
}
@media (prefers-color-scheme: dark){
  :root{
    --skel-base: #2a2a2a;
    --skel-lite: #1b1b1b;
    --skel-dark: rgba(255,255,255,.08);
  }
}

/* сама карточка-скелет не интерактивна */
.card.is-skeleton{
  pointer-events: none;
}

/* область изображения карточки: видимый фон, чтобы «пятно» сразу было */
.card.is-skeleton .card-img{
  background: var(--skel-lite);
  position: relative;
  overflow: hidden;
}

/* универсальный блок-скелет */
.skel{
  display: block;
  position: relative;
  background: var(--skel-base);
  border-radius: 10px;
  overflow: hidden;
}

/* размеры конкретных полосок */
.skel-img{ position:absolute; inset:0; border-radius: 22px; }
.skel-title{ height:18px; width:70%; margin:10px 6px 6px; }
.skel-sub{   height:14px; width:45%; margin:0 6px 8px; opacity:.85; }
.skel-price{ height:18px; width:82px; }
.skel-chip{  height:22px; width:64px; border-radius:999px; }

/* лёгкий шиммер — без лишней яркости */
.skel::after{
  content:"";
  position:absolute; inset:0;
  transform: translateX(-100%);
  background: linear-gradient(90deg,
    transparent 0%,
    rgba(255,255,255,.35) 40%,
    rgba(255,255,255,.55) 50%,
    rgba(255,255,255,.35) 60%,
    transparent 100%
  );
  animation: skel-shimmer 1.2s ease-in-out infinite;
  mix-blend-mode: screen;
}
@media (prefers-color-scheme: dark){
  .skel::after{
    background: linear-gradient(90deg,
      transparent 0%,
      rgba(255,255,255,.10) 40%,
      rgba(255,255,255,.16) 50%,
      rgba(255,255,255,.10) 60%,
      transparent 100%
    );
    mix-blend-mode: normal;
  }
}

@keyframes skel-shimmer{
  0%   { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* чуть приглушим текстовые скелеты внутри карточки */
.card.is-skeleton .card-body{ padding:10px 6px; }
.card.is-skeleton .price-row{ display:flex; justify-content:space-between; align-items:center; margin-top:10px; }

/* чтобы любые тени/стекла вокруг не «съедали» скелет */
.card.is-skeleton,
.card.is-skeleton .card-img,
.card.is-skeleton .skel{ will-change: transform, opacity; }
/* === Per-card image skeleton + fade-in ========================= */
.card-img{
  position: relative;            /* гарантия для overlay */
  background: var(--skel-lite, #f6f6f6);
  overflow: hidden;
}

/* картинка появляется плавно после onload */
.card-img img{
  display:block;
  width:100%;
  height:100%;
  object-fit:cover;
  opacity: 0;
  transition: opacity .22s ease;
}
.card-img img.is-ready{ opacity: 1; }

/* overlay-скелет поверх конкретной картинки до её загрузки */
.img-skel{
  position:absolute;
  inset:0;
  background: var(--skel-base, #eee);
  border-radius: 22px;          /* как у .card-img */
  overflow:hidden;
}
.img-skel::after{
  content:"";
  position:absolute; inset:0;
  transform: translateX(-100%);
  background: linear-gradient(90deg,
    transparent 0%,
    rgba(255,255,255,.35) 40%,
    rgba(255,255,255,.55) 50%,
    rgba(255,255,255,.35) 60%,
    transparent 100%
  );
  animation: skel-shimmer 1.2s ease-in-out infinite;
}
@media (prefers-color-scheme: dark){
  .img-skel::after{
    background: linear-gradient(90deg,
      transparent 0%,
      rgba(255,255,255,.10) 40%,
      rgba(255,255,255,.16) 50%,
      rgba(255,255,255,.10) 60%,
      transparent 100%
    );
  }
}
/* === Skeletons: pale grey override =============================== */
:root{
  --skel-base: #eeeeee;   /* основной серый блок */
  --skel-lite: #f6f6f6;   /* фон для областей изображения */
  --skel-gloss-a: rgba(255,255,255,.35);
  --skel-gloss-b: rgba(255,255,255,.55);
}
@media (prefers-color-scheme: dark){
  :root{
    --skel-base: #2a2a2a;
    --skel-lite: #1b1b1b;
    --skel-gloss-a: rgba(255,255,255,.10);
    --skel-gloss-b: rgba(255,255,255,.16);
  }
}

/* карточка-скелет и фон изображения — светло-серые */
.card.is-skeleton{ pointer-events:none; }
.card.is-skeleton .card-img{ background: var(--skel-lite) !important; }

/* универсальный блок-скелет — бледно-серый */
.skel{
  background: var(--skel-base) !important;
  border-radius: 10px;
  position: relative;
  overflow: hidden;
}

/* размеры полосок (оставил как у тебя; при желании можно не дублировать) */
.skel-title{ height:18px; width:70%; margin:10px 6px 6px; }
.skel-sub{   height:14px; width:45%; margin:0 6px 8px; opacity:.85; }
.skel-price{ height:18px; width:82px; }
.skel-chip{  height:22px; width:64px; border-radius:999px; }

/* мягкий шиммер без «яркой белой полосы» */
.skel::after,
.img-skel::after{
  content:"";
  position:absolute; inset:0;
  transform: translateX(-100%);
  background: linear-gradient(90deg,
    transparent 0%,
    var(--skel-gloss-a) 40%,
    var(--skel-gloss-b) 50%,
    var(--skel-gloss-a) 60%,
    transparent 100%
  );
  animation: skel-shimmer 1.2s ease-in-out infinite;
}
@keyframes skel-shimmer{
  0%   { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* overlay-скелет для конкретной картинки до onload — тоже бледно-серый */
.img-skel{
  position:absolute; inset:0;
  background: var(--skel-base) !important;
  border-radius: 22px;
  overflow:hidden;
}

/* сама область .card-img имеет светлый фон и плавное появление изображения */
.card-img{ position:relative; background: var(--skel-lite); overflow:hidden; }
.card-img img{ opacity:0; transition: opacity .22s ease; }
.card-img img.is-ready{ opacity:1; }

/* === SKELETON: hard light palette in any theme (final override) === */
:root{
  --skel-base: #eeeeee;   /* цвет блоков-скелетов */
  --skel-lite: #f5f5f5;   /* фон области изображения/карточки */
  --skel-gloss-a: rgba(255,255,255,.32);
  --skel-gloss-b: rgba(255,255,255,.52);
}

/* 1) единый фон для областей скелета */
html body .card.is-skeleton .card-img,
html body .card-img,
html body .skel,
html body .img-skel{
  background: var(--skel-lite) !important;
}

/* 2) сами «полоски» и overlay — светло-серые */
html body .skel,
html body .img-skel{
  background: var(--skel-base) !important;
  border-radius: 10px;
  position: relative;
  overflow: hidden;
}

/* 3) мягкий шиммер — одинаковый для обеих тем */
html body .skel::after,
html body .img-skel::after{
  content:""; position:absolute; inset:0;
  transform: translateX(-100%);
  background: linear-gradient(90deg,
    rgba(255,255,255,0) 0%,
    var(--skel-gloss-a) 40%,
    var(--skel-gloss-b) 50%,
    var(--skel-gloss-a) 60%,
    rgba(255,255,255,0) 100%
  );
  animation: skel-shimmer 1.2s ease-in-out infinite;
  mix-blend-mode: normal !important; /* глушим screen */
}

/* 4) и в тёмной теме оставляем ту же светлую палитру */
@media (prefers-color-scheme: dark){
  html body .card.is-skeleton .card-img,
  html body .card-img,
  html body .skel,
  html body .img-skel{
    background: var(--skel-lite) !important;
  }
}
/* === PROMO: баннеры на главной === */
.promo-banner{
  grid-column: span 2; display:block; border-radius: var(--radius,22px);
  overflow:hidden; border:1px solid var(--stroke,#ececec);
}
.promo-banner img{ width:100%; display:block; height:auto; }

/* Карточка: промо-бейджи (левый верхний угол, напротив сердечка) */
.card .media{ position:relative; }
.promo-badges{
  position:absolute; left:8px; top:8px; display:flex; flex-direction:column; gap:6px; z-index:2;
}
.promo-badge{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px; font-size:12px; font-weight:900; line-height:1;
  color:#fff; box-shadow:0 6px 18px rgba(0,0,0,.20); border:1px solid rgba(255,255,255,.22);
}
.promo-badge.discount{ background:#ef4444; }
.promo-badge.x2{ background:#06b6d4; }

/* Карточка: цена с зачёркнутой старой */
.card .price{ display:flex; align-items:center; gap:8px; margin-top:6px; }
.card .price .old{ text-decoration:line-through; color:#a1a1aa; font-weight:700; }
.card .price .cur{ font-weight:900; }

/* Чип-категория "Акции" не требует отдельного стиля — обычный .chip подходит */
/* === PROMO PAGE BACKDROP ===================================== */
#view.promo-page{
  background-color: var(--promo-page-bg, #0b1220) !important;
  /* снежный паттерн зашивается инлайн из Promo.js через background-image */
  position: relative;
}
#view.promo-page::before{
  /* мягкий белый туман поверх фона: усиливает «зимний» вайб */
  content: "";
  position: absolute; inset: 0;
  pointer-events: none;
  background: linear-gradient(180deg,
    rgba(255,255,255,0.04) 0%,
    rgba(255,255,255,0.00) 24%,
    rgba(255,255,255,0.03) 100%);
  mix-blend-mode: screen;
  opacity: .8;
}
/* === XMAS THEME (light red) — фон и карточки одного тона ============ */
:root{
  /* при желании быстро поменять оттенок — правь эти токены */
  --xmas-bg:   #ffe7ea;  /* светло-красный фон страницы и карточек */
  --xmas-bg-2: #fff1f3;  /* чуть светлее для мягкого градиента */
  --xmas-stroke: rgba(0,0,0,.08);
  --xmas-shadow: 0 8px 24px rgba(0,0,0,.06);
}

/* 1) Общий фон приложения в .theme-xmas — светло-красный */
.theme-xmas body{
  background:
    radial-gradient(1100px 700px at 8% -8%, rgba(255, 120, 120, .08) 0%, rgba(0,0,0,0) 55%),
    radial-gradient(1100px 700px at 100% 0%, rgba(255, 196,   0, .06) 0%, rgba(0,0,0,0) 55%),
    linear-gradient(180deg, var(--xmas-bg-2) 0%, var(--xmas-bg) 100%);
  background-image:
    radial-gradient(1100px 700px at 8% -8%, rgba(255, 120, 120, .08) 0%, rgba(0,0,0,0) 55%),
    radial-gradient(1100px 700px at 100% 0%, rgba(255, 196,   0, .06) 0%, rgba(0,0,0,0) 55%),
    url('assets/promo/newyear/xmas-pattern1.svg'),
    linear-gradient(180deg, var(--xmas-bg-2) 0%, var(--xmas-bg) 100%);
  background-repeat: no-repeat, no-repeat, repeat, no-repeat;
  background-size: auto, auto, 420px, auto;
  color: var(--text);
}

/* 2) Фон промо-страницы (если задаётся из JS — это её бэкап/дефолт) */
#view.promo-page{
  background-color: var(--promo-page-bg, var(--xmas-bg)) !important;
}

/* 3) Сетка и карточки — того же цвета, что и фон */
.theme-xmas .grid{ background: transparent; } /* сетка прозрачная, фон берётся со страницы */
.theme-xmas .card{
  background: var(--xmas-bg) !important;
  border: 1px solid var(--xmas-stroke) !important;
  box-shadow: var(--xmas-shadow) !important;
}
.theme-xmas .card .card-img{ background: var(--xmas-bg) !important; }

/* 4) Мелкие элементы — чтобы всё выглядело цельно на светло-красном */
.theme-xmas .chip,
.theme-xmas .pill,
.theme-xmas .thumb{
  background: #fff;                /* чёткая читаемость на красном */
  border: 1px solid var(--xmas-stroke);
}
.theme-xmas .promo-badge{
  border-color: rgba(255,255,255,.28);
  box-shadow: 0 6px 16px rgba(0,0,0,.18);
}

/* 5) Хедер и таббар — без изменений контрастности (можно убрать блок, если не нужно) */
.theme-xmas .app-header{
  background: linear-gradient(180deg, rgba(255,255,255,.94) 0%, rgba(255,255,255,.86) 100%);
  border-bottom-color: rgba(0,0,0,.06);
}
.theme-xmas .tabbar-inner{
  background: rgba(31,30,30,.96);
  box-shadow: 0 10px 40px rgba(0,0,0,.25);
}


/* === SAFE PRICES: карточки в любых сетках не «ломаются» ============== */
.card .price{
  display:flex; align-items:baseline; gap:8px; margin-top:6px; flex-wrap:wrap;
}
.card .price .old{
  text-decoration: line-through; color:#a1a1aa; font-weight:700;
  font-size: 13px; line-height:1;
}
.card .price .cur{
  font-weight:900; font-size: 16px; line-height:1;
}

/* если вдруг карточка очень узкая — ещё компактнее */
@media (max-width: 360px){
  .card .price .old{ font-size:12px }
  .card .price .cur{ font-size:14px }
}
/* === PRICE: единый стандартный размер + деликатное выделение скидки === */

/* базовый размер как раньше (карточки) */
.card .price{
  font-weight: 800;
  font-size: 20px;   /* ← стандарт */
  line-height: 1.1;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

/* показываем только .cur — .old больше не используем */
.card .price .cur{
  font: inherit;
}

/* скидочная цена чуть подсвечена (тонкая тень) */
.card .price .cur.deal{
  position: relative;
  text-shadow: 0 1px 0 rgba(0,0,0,.06);
}

/* маленький процент-чип рядом с ценой */
.price-chip{
  display: inline-flex;
  align-items: center;
  height: 20px;
  padding: 0 8px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 900;
  line-height: 1;
  color: #fff;
  background: #ef4444;                /* как промо-бэйдж скидки */
  border: 1px solid rgba(255,255,255,.22);
  box-shadow: 0 6px 16px rgba(0,0,0,.16);
}

/* на очень узких экранах не уменьшаем саму цену, только чип */
@media (max-width: 360px){
  .price-chip{ height: 18px; font-size: 11px; padding: 0 7px; }
}

/* подчистим старые эксперименты, если они были ниже по файлу */
.card .price .old{ display: none !important; }
.card .price .cur{ font-size: 20px !important; } /* защита от прежних переопределений */
/* === PROMO BADGES: bottom-left on image === */
.promo-badges{
  position: absolute;
  left: 8px;
  bottom: 8px;       /* ↓ вместо top */
  top: auto !important;
  display: flex;
  flex-direction: column;
  gap: 6px;
  z-index: 2;
}

/* На очень узких — прижимаем ещё чуть ниже/левее */
@media (max-width: 380px){
  .promo-badges{ left: 6px; bottom: 6px; }
}

/* === PRICE DEAL: деликатное выделение скидочной цены === */
.card .price .cur.deal{
  position: relative;
  text-shadow: 0 1px 0 rgba(0,0,0,.06);
  filter: drop-shadow(0 2px 10px rgba(239,68,68,.18)); /* мягкое «свечение» */
}

/* тонкая «подсветка-подчёркивание» под ценой */
.card .price .cur.deal::after{
  content:"";
  position:absolute;
  left:-2px; right:-2px; bottom:-3px;
  height:6px;
  border-radius:6px;
  background: linear-gradient(90deg, rgba(239,68,68,.18), rgba(239,68,68,.10));
  pointer-events:none;
}

/* На тёмной теме чуть ярче */
@media (prefers-color-scheme: dark){
  .card .price .cur.deal::after{
    background: linear-gradient(90deg, rgba(239,68,68,.28), rgba(239,68,68,.16));
  }
}

/* Страховка: если где-то осталась вёрстка процента у цены — скрыть */
.price-chip{ display:none !important; }
/* === DEAL PRICE COLOR THEME ===================================== */
/* Токены цвета для акционной цены — можно менять под фирстиль */
:root{
  --deal-fg:    #efd544;  /* основной цвет цены со скидкой */
  --deal-glow:  rgba(239,68,68,.16); /* лёгкое свечение/подложка */
}
@media (prefers-color-scheme: dark){
  :root{
    --deal-fg:   #fff06b;
    --deal-glow: rgba(255,107,107,.24);
  }
}

/* Базовый вид: просто другой цвет + лёгкий оптический акцент */
.card .price .cur.deal{
  color: var(--deal-fg) !important;
  text-shadow: 0 1px 0 rgba(0,0,0,.05);
}

/* Очень деликатное «подсвечивание» под текстом — можно отключить, если не нужно */
.card .price .cur.deal::after{
  content:"";
  position:absolute;
  left:-2px; right:-2px; bottom:-3px;
  height:6px; border-radius:6px;
  background: var(--deal-glow);
  pointer-events:none;
}

/* Если хочешь вообще без подложки — раскомментируй ниже строчку */
/* .card .price .cur.deal::after{ display:none !important; } */

/* На случай старых правил — отключаем прошлые эффекты,
   чтобы не было двойного свечения/фильтров */
.card .price .cur.deal{ filter:none !important; }
/* === OFF: underline/glow under deal price === */
.card .price .cur.deal::after{
  content: none !important;
  display: none !important;
}

/* На всякий: никаких текстовых подчёркиваний у цен */
.card .price .cur,
.card .price .cur.deal{
  text-decoration: none !important;
}
/* === XMAS (BORDEAUX): фон и карточки одного цвета, БЕЗ теней/рамок === */
:root{
  --xmas-bg:   #3e0a0a;  /* основной бордовый */
  --xmas-bg-2: #5a0f12;  /* верхний оттенок градиента */
}

/* Фон приложения */
.theme-xmas body{
  background:
    radial-gradient(1200px 800px at 10% -10%, rgba(255,255,255,.08) 0%, rgba(255,255,255,0) 55%),
    radial-gradient(1200px 800px at 100% 0%, rgba(255,255,255,.06) 0%, rgba(255,255,255,0) 55%),
    url('assets/promo/newyear/xmas-pattern1.svg'),
    linear-gradient(180deg, var(--xmas-bg-2) 0%, var(--xmas-bg) 100%);
  background-repeat: no-repeat, no-repeat, repeat, no-repeat;
  background-size: auto, auto, 420px, auto;
}

/* Сетка берёт фон страницы; карточки — ТАКОГО ЖЕ цвета, без обводок/теней */
.theme-xmas .grid{ background: transparent !important; }
.theme-xmas .card{
  background: var(--xmas-bg) !important;
  border: none !important;
  box-shadow: none !important;
}

/* Область изображения карточки — чтобы не выбивалась по тону */
.theme-xmas .card .card-img{ background: var(--xmas-bg) !important; }

/* Кнопка-избранное на карточке — без белой «таблетки», чтобы не резало глаз */
.theme-xmas .card .fav{
  background: rgba(255,255,255,.10) !important;
  border: none !important;
  box-shadow: none !important;
  color: #fff !important;
}

/* Текст в карточке чуть светлее для читаемости */
.theme-xmas .card .card-body .title{ color:#fff !important; }
.theme-xmas .card .card-body .subtitle{ color:rgba(255,255,255,.75) !important; }
.theme-xmas .card .price{ color:#fff !important; }

/* Баннер промо и бейджи можно оставить как есть; при желании — подмерцай контрастом */
/* PROMO view: используем картинку из JS-переменной */
#view.promo-page{
  background-color: var(--promo-page-bg, #3e0a0a) !important;
  background-image: var(--promo-bg-img, none);   /* ← из applyPromoTheme */
  background-repeat: repeat;
  background-size: 420px auto;                   /* подгон под твой паттерн */
  position: relative;
}

/* туман сверху можно оставить как есть */
#view.promo-page::before{
  content:"";
  position:absolute; inset:0;
  pointer-events:none;
  background: linear-gradient(180deg,
    rgba(255,255,255,0.04) 0%,
    rgba(255,255,255,0.00) 24%,
    rgba(255,255,255,0.03) 100%);
  mix-blend-mode: screen;
  opacity:.8;
}
/* === Promo page only: прозрачный фон сетки ===================== */
#view.promo-page .grid{
  background: transparent !important;
}
/* === PROMO PAGE: светлый текст заголовков и лидов =================== */
#view.promo-page .page-title h1,
#view.promo-page h1,
#view.promo-page h2,
#view.promo-page .promo-title,
#view.promo-page .promo-lead,
#view.promo-page .xmas-headline{
  color:#fff !important;
  text-shadow: 0 1px 0 rgba(0,0,0,.22);
}

/* вспомогательные тексты/ссылки — тоже светлее */
#view.promo-page .muted{ color:rgba(255,255,255,.78) !important; }
#view.promo-page a{ color:#fff !important; }

/* если фраза выводится отдельным блоком — можно дать класс и не гадать по селекторам */
#view.promo-page .promo-text--light{ color:#fff !important; }
/* === PROMO PAGE: прозрачный фон и светлый текст (точечный фикс) === */

/* 1) фон: делаем прозрачным у всех внутренних обёрток промо-экрана */
#view.promo-page,
#view.promo-page .view,
#view.promo-page .promo-wrap,
#view.promo-page .section,
#view.promo-page .grid{
  background: transparent !important;
  background-color: transparent !important;
  border-color: transparent !important; /* на случай бордеров */
}

/* если используешь туман ::before — оставляем его; иначе можно отключить:
#view.promo-page::before{ display:none !important; }
*/

/* 2) текст: именно те классы, что у тебя в DOM (p-title / p-desc) */
#view.promo-page .p-title{
  color:#fff !important;
  text-shadow: 0 1px 0 rgba(0,0,0,.22);
}
#view.promo-page .p-desc,
#view.promo-page .muted{
  color: rgba(255,255,255,.78) !important;
}

/* 3) ссылки/кнопки внутри промо (если есть) — читаемые на тёмном фоне */
#view.promo-page a{ color:#fff !important; }
#view.promo-page .pill,
#view.promo-page .chip{
  border-color: rgba(255,255,255,.28) !important;
}

/* 4) сетка карточек на промо — без собственной «бумаги» */
#view.promo-page .card{
  background: transparent !important;
  box-shadow: none !important;
  border-color: rgba(255,255,255,.14) !important; /* можно убрать, если не нужно */
}
/* === PROMO PAGE: тёмная подложка под контент ===================== */
:root{
  /* интенсивность затемнения можно менять 0.20–0.70 */
  --promo-dim: .45;
}

#view.promo-page{
  position: relative;           /* свой стек слоёв */
  isolation: isolate;           /* застраховаться от внешних слоёв */
}

/* существующий «туман» (::before) держим поверх тёмной подложки */
#view.promo-page::before{
  z-index: 1;                   /* туман над затемнением */
}

/* новая тёмная подложка — ниже тумана, но выше фоновой картинки */
#view.promo-page::after{
  content: "";
  position: absolute; inset: 0;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(1200px 700px at 50% -10%,
      rgba(0,0,0, calc(var(--promo-dim) + .10)) 0%,
      rgba(0,0,0, var(--promo-dim)) 40%,
      rgba(0,0,0, calc(var(--promo-dim) - .10)) 65%,
      rgba(0,0,0, calc(var(--promo-dim) - .20)) 100%
    ),
    linear-gradient(180deg,
      rgba(0,0,0, calc(var(--promo-dim) - .10)) 0%,
      rgba(0,0,0, calc(var(--promo-dim) + .05)) 100%
    );
}

/* весь контент промо выше обоих оверлеев */
#view.promo-page > *{
  position: relative;
  z-index: 2;
}
